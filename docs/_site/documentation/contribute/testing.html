    <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
 



<link rel="shortcut icon" href="//www.eclipse.org/smarthome/img/favicon.png"></link>
<title>Eclipse SmartHome - A Flexible Framework for the Smart
	Home</title>
 
<!-- CSS -->
<link href="http://www.eclipse.org/smarthome/css/materialize.css" type="text/css" rel="stylesheet"
	media="screen,projection" />
<link href="http://www.eclipse.org/smarthome/css/highlight.github.css" type="text/css" rel="stylesheet"
    	media="screen,projection" />
<link href="../../css/styles.css" rel="stylesheet" />

<!-- Font -->
<link href='http://fonts.googleapis.com/css?family=Lato:300,400,700'
	rel='stylesheet' type='text/css' />
    
</head>
<body class="documentation">
	<div id="header" class="navbar-fixed">
		<nav role="navigation">
			<div class="container">
				<div class="nav-wrapper">
					<a href="../../index.html"><img id="logo" src="//www.eclipse.org/smarthome/img/eclipse_logo.png" /></a>
					<a href="#" data-activates="nav-mobile" class="button-collapse"><i
						class="mdi-navigation-menu"></i></a>
					<ul class="right hide-on-med-and-down">
						<li><a href="../../getting-started.html">Getting Started</a></li>
						<li><a href="../../documentation/index.html">Documentation</a></li>
						<li><a href="http://github.com/eclipse/smarthome">GitHub</a></li>
					</ul>
					<ul id="nav-mobile" class="side-nav">
                        <li><a href="../../index.html">Home</a></li>
						<li><a href="../../getting-started.html">Getting Started</a></li>
						<li><a href="../../documentation/index.html">Documentation</a></li>
						<li><a href="http://github.com/eclipse/smarthome">GitHub</a></li>
					</ul>
				</div>
			</div>
		</nav>
	</div>
    
    <section id="documentation" class="text content-wrapper">
        <div class="container">
            <div class="side-nav-wrapper">
                





<ul class="nav">
    <li>
        <a href="../../documentation/index.html">Overview</a>
    </li>
    <li>
        <a href="../../documentation/concepts/index.html">Concepts</a>
        <ul>
            <li>
                 <a href="../../documentation/concepts/index.html">Overview</a>
            </li>
            <li>
                 <a href="../../documentation/concepts/extensions.html">Extensions</a>
            </li>
            <li>
                 <a href="../../documentation/concepts/internationalization.html">Internationalization</a>
            </li>
            <li>
                 <a href="../../documentation/concepts/thing-status.html">Thing Status</a>
            </li>
    	</ul>
    </li>
	<li>
        <a href="../../documentation/binding-development/how-to.html">Binding Development</a>
        <ul>
        	<li>
                 <a href="../../documentation/binding-development/how-to.html">How To</a>
            </li>
            <li>
                 <a href="../../documentation/binding-development/thing-definition.html">Thing Definition</a>
            </li>
            <li>
                 <a href="../../documentation/binding-development/thing-handler.html">Thing Handler</a>
            </li>
            <li>
                 <a href="../../documentation/binding-development/discovery.html">Discovery</a>
            </li>
            <li>
                 <a href="../../documentation/binding-development/xml-reference.html">XML Reference Guide</a>
            </li>
			<li>
                 <a href="../../documentation/binding-development/dependencies.html">Dependencies</a>
            </li>
            <li>
                 <a href="../../documentation/binding-development/docs.html">Documentation</a>
            </li>
            <li>
                 <a href="../../documentation/binding-development/faq.html">FAQ</a>
            </li>
        </ul>    
    </li>
	<li>
        <a href="../../documentation/remote/events.html">Remote Access</a>
        <ul>
        	<li>
                 <a href="../../documentation/remote/events.html">Events (SSE)</a>
            </li>
        </ul>    
    </li>
    <li>
        <a href="../../documentation/configuration/things.html">Configuration</a>
        <ul>
            <li>
                 <a href="../../documentation/configuration/things.html">Thing DSL</a>
            </li>
        </ul>    
    </li>
    <li>
        <a href="../../documentation/contribute/contributing.html">Contribute</a>
        <ul>
            <li>
                 <a href="../../documentation/contribute/contributing.html">Contributing</a>
            </li>
            <li>
                 <a href="../../documentation/contribute/ide.html">IDE</a>
            </li>
            <li>
                 <a href="../../documentation/contribute/guidelines.html">Guidelines</a>
            </li>
			<li>
                 <a href="../../documentation/contribute/testing.html">Testing</a>
            </li>
        </ul>    
    </li>
</ul>
            </div>    
            <div class="content">  
	            
<h1 id="testing-eclipse-smarthome">Testing Eclipse SmartHome</h1>
<p>There are two different kinds of approaches for testing Eclipse SmartHome. One is to use plain JUnit tests for testing simple classes. The other is to execute JUnit tests within the OSGi environment to test OSGi services and dynamic behaviour. Both approaches are supported through a simple infrastructure, which allows to easily write and execute tests.</p>

<h2 id="test-fragment">Test fragment</h2>

<p>In OSGi tests are implemented in a separate fragment bundle, which host is the bundle, that should be tested. The name of the test fragment bundle should be the same as the bundle to test with a “.test” suffix. The MANIFEST.MF file must contain a <code>Fragment-Host</code> entry. Fragment bundles inherit all imported packages from the host bundle. In addition the fragment bundle must import the <code>org.junit</code> package with a minimum version of 4.0.0 specified. The following code snippet shows a manifest file of the test fragment for the <code>org.eclipse.smarthome.core.library</code> bundle.</p>

<pre><code>Manifest-Version: 1.0
Bundle-ManifestVersion: 2
Bundle-Name: Tests for the Eclipse SmartHome Core Library
Bundle-SymbolicName: org.eclipse.smarthome.core.library.test
Bundle-Version: 0.7.0.qualifier
Bundle-Vendor: Eclipse.org/SmartHome
Fragment-Host: org.eclipse.smarthome.core.library
Bundle-RequiredExecutionEnvironment: JavaSE-1.7
Import-Package: org.junit;version="4.0.0"
</code></pre>

<p>Tests are typically placed inside the folder <code>src/test/java</code>.</p>

<h2 id="unit-tests">Unit tests</h2>

<p>Each class inside the test folder, which has a public method with a <code>@Test</code> annotation will automatically be executed as a test. Inside the class one can refer to all classes from the host bundle and all imported classes. The following code snippet shows a simple JUnit test which tests the <code>toString</code> conversation of a PercentType.</p>

<pre><code>public class PercentTypeTest {
	@Test
	public void DoubleValue() {
        PercentType pt = new PercentType("0.0001");
        assertEquals("0.0001", pt.toString());
	}
}
</code></pre>

<p>Using the the [https://code.google.com/p/hamcrest/ hamcrest] matcher library is a good way to write expressive assertions. In contrast to the original assertion statements from JUnit the hamcrest matcher library allows to define the assertion in a more natural order:</p>

<pre><code>PercentType pt = new PercentType("0.0001");
assertThat pt.toString(), is(equalTo("0.0001"))
</code></pre>

<p>To use the hamcrest library in your test project, you just have to add the following entry to the list of imported packages:</p>

<pre><code>org.hamcrest;core=split
</code></pre>

<p>Tests can be executed from Eclipse by right-clicking the test file and clicking on <code>Run As =&gt; JUnit Test</code>. From maven one can execute the test with <code>mvn test</code> command in the folder of the test fragment bundle.</p>

<h2 id="groovy">Groovy</h2>

<p>Using the JVM language Groovy tests are very easy and efficient to write. Groovy supports mocking without any frameworks. Language features like closures, type-inference and native syntax for maps and lists allow to implement short and easy to understand tests. Thus Eclipse SmartHome comes with a out-of-the-boc-support for Groovy-testing in Eclipse and maven. Each test file which is placed under <code>src/test/groovy</code> will be automatically compiled and executed in Eclipse and maven. Moreover the Eclipse SmartHome Yoxos profile contains the Groovy-Eclipse-Plugin.</p>

<p>Even the following examples are presented in Groovy, unit and OSGi tests can also be implemented in Java. If the default mocking capabilities of Groovy do not fulfil the requirements, Groovy can also be combined with Java mocking frameworks like [https://code.google.com/p/mockito/ mockito].</p>

<p>== OSGi-Tests ==</p>

<p>Some components of Eclipse SmartHome are heavily bound to the OSGi runtime, because they use OSGi core services like the EventAdmin or the ConfigurationAdmin. That makes it hard to test those components outside of the OSGi container. Equinox provides a possibility to execute a JUnit tests inside the OSGi environment, where the test has access to OSGi services.</p>

<p>Eclipse SmartHome comes with an abstract base class <code>OSGiTest</code> for OSGi tests. The base class sets up a bundle context and has convenience methods for registering mocks as OSGi services and the retrieval of registered OSGi services. The following Groovy test class shows how to test the <code>ItemRegistry</code> by providing a mocked <code>ItemProvider</code>.</p>

<pre><code>class ItemRegistryOSGiTest extends OSGiTest {
 
 ItemRegistry itemRegistry
 ItemProvider itemProvider
 def ITEM_NAME = "switchItem"
 
 @Before
 void setUp() {
     itemRegistry = getService(ItemRegistry)
     itemProvider = [
         getItems: {[new SwitchItem(ITEM_NAME)]}, 
         addItemChangeListener: {def itemCHangeListener -&gt; },
         removeItemChangeListener: {def itemCHangeListener -&gt; }] as ItemProvider
 }
 
 @Test
 void 'assert getItems returns item from registered ItemProvider'() {
 
     assertThat itemRegistry.getItems().size, is(0)
 
     registerService itemProvider
 
     def items = itemRegistry.getItems()
     assertThat items.size, is(1)
     assertThat items.first().name, is(equalTo(ITEM_NAME))
 
     unregisterService itemProvider
 
     assertThat itemRegistry.getItems().size, is(0)
 }
}
</code></pre>

<p>In the <code>setUp</code> method the <code>ItemRegistry</code> OSGi service is retrieved through the method <code>getService</code> from the base class <code>OSGiTest</code> and assigned to a private variable. After it a new <code>ItemProvider</code> mock is created, which returns one item. The test method first checks that no item is inside the registry. Afterwards it registers the mocked <code>ItemProvider</code> as OSGi service with the method <code>registerService</code> and checks if the <code>ItemRegistry</code> returns one item now. At the end the mock is unregistered again.</p>

<p>In Eclipse the tests can be executed by right-clicking the test file and clicking on <code>Run As =&gt; JUnit Plug-In Test</code>. The launch config must be adapted, by selecting the bundle to test under the <code>Plug-Ins</code> tab and by clicking on <code>Add Required Plug-Ins</code>. Moreover you have to set the Auto-Start option to <code>true</code>. If the bundle that should be tested makes use of declarative services (has xml files in OSGI-INF folder), the bundle <code>org.eclipse.equinox.ds</code> must also be selected and also the required Plug-Ins of it. The <code>Validate Plug-Ins</code> button can be used to check if the launch config is valid. To avoid the manual selection of bundles, one can also choose <code>all workspace and enabled target plug-ins</code> with default <code>Default Auto-Start</code> set to <code>true</code>. The disadvantage is, that this will start all bundles, which makes the test execution really slow and will prodcue a lot of errors on the OSGi console. It is a good practice to store a launch configuration file, that launches all test cases for a test fragment.</p>

<p>From maven the test can be executed by calling <code>mvn integration-test</code>. For executing the test in maven, tycho calculates the list of depended bundles automatically from package imports. Only if there is no dependency to a bundle, the bundle must be added manually to the test execution environment. For example Eclipse SmartHome makes use of OSGi declarative services. That allows to define service components through XML files. In order to support declarative services in the test environment the according bundle must be added in the pom file within the <code>tycho-surefire-plugin</code> configuration section as followed:</p>

<pre><code>...
&lt;build&gt;
 &lt;plugins&gt;
     &lt;plugin&gt;
         &lt;groupId&gt;org.eclipse.tycho&lt;/groupId&gt;
         &lt;artifactId&gt;tycho-surefire-plugin&lt;/artifactId&gt;
         &lt;version&gt;${tycho-version}&lt;/version&gt;
         &lt;configuration&gt;
             &lt;dependencies&gt;
                 &lt;dependency&gt;
                     &lt;type&gt;eclipse-plugin&lt;/type&gt;
                     &lt;artifactId&gt;org.eclipse.equinox.ds&lt;/artifactId&gt;
                     &lt;version&gt;0.0.0&lt;/version&gt;
                 &lt;/dependency&gt;
             &lt;/dependencies&gt;
             &lt;bundleStartLevel&gt;
                 &lt;bundle&gt;
                     &lt;id&gt;org.eclipse.equinox.ds&lt;/id&gt;
                     &lt;level&gt;1&lt;/level&gt;
                     &lt;autoStart&gt;true&lt;/autoStart&gt;
                 &lt;/bundle&gt;
             &lt;/bundleStartLevel&gt;
         &lt;/configuration&gt;
     &lt;/plugin&gt;
 &lt;/plugins&gt;
&lt;/build&gt;
...
</code></pre>

<p>In the dependency definition the <code>artifactId</code> is the name of the required bundle, where the version can always be <code>0.0.0</code>. Within the <code>bundleStartLevel</code> definition the start level and auto start of the depended bundles can be configured. The <code>org.eclipse.equinox.ds</code> bundle must have level 1 and must be started automatically.</p>

            </div>
        </div>
    </section>
    
	    



	     
    <footer class="page-footer">
		<div class="container">
			<div class="row">
				<div class="col l6 s12">
					<p class="white-text">Eclipse SmartHome is an <a href="http://iot.eclipse.org">Eclipse IoT</a>
						project</p>
					<p>
						<a href="http://iot.eclipse.org"><img src="//www.eclipse.org/smarthome/img/iot-logo.png"></a>
					</p>
				</div>
				<div class="col l6 s12" data-twttr-id="twttr-sandbox-0">
					<p class="white-text">Connect with Eclipse SmartHome</p>
					<iframe
						src="https://ghbtns.com/github-btn.html?user=eclipse&repo=smarthome&type=star&count=true&size=large"
						frameborder="0" scrolling="0" width="160px" height="30px"></iframe>
					<br /> <a class="twitter-follow-button" data-size="large"
						href="https://twitter.com/smarthome"> Follow @smarthome</a><br />
				</div>
			</div>
		</div>
		<div class="footer-copyright">
			<div class="container center">
				<a href="https://www.eclipse.org/legal/copyright.php">Copyright
					Agent</a> · <a href="https://www.eclipse.org/legal/privacy.php">Privacy</a>
				· <a href="https://www.eclipse.org/legal/termsofuse.php">Terms</a> ·
				<a href="https://www.eclipse.org/legal/">Legal</a>

			</div>
		</div>
	</footer>
    
	<script src="//www.eclipse.org/smarthome/js/jquery.min.js"></script>
	<script src="//www.eclipse.org/smarthome/js/jquery.scrollme.min.js"></script>
    <script src="//www.eclipse.org/smarthome/js/jquery.sticky.js"></script>
	<script src="//www.eclipse.org/smarthome/js/materialize.js"></script>
    <script src="//www.eclipse.org/smarthome/js/highlight.pack.js"></script>
	<script src="../../js/init.js"></script>
	<script>
        window.twttr = (function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0], t = window.twttr || {};
            if (d.getElementById(id))
                return t;
            js = d.createElement(s);
            js.id = id;
            js.src = "https://platform.twitter.com/widgets.js";
            fjs.parentNode.insertBefore(js, fjs);

            t._e = [];
            t.ready = function(f) {
                t._e.push(f);
            };

            return t;
        }(document, "script", "twitter-wjs"));
    </script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55850963-1', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>